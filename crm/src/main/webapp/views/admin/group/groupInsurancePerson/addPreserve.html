#@layout() #define main()
<div class="layui-card">
	<div class="headerttl">人员管理列表</div>
	<div class="layui-card-body">
		<div class='layui-form' lay-filter='form_pro'>
			<div class='layui-row layui-col-space5'>
				<div class="layui-input-inline layui-col-sm4 layui-col-md2">
					<input name='name' autocomplete='off' class='layui-input'
						placeholder='姓名' />
				</div>
				<div class="layui-input-inline layui-col-sm4 layui-col-md2">
					<input name='id_num' autocomplete='off' class='layui-input'
						placeholder='身份证' />
				</div>
				<div class="layui-input-inline layui-col-sm4 layui-col-md2">
					<select name='status' lay-search>
						<option value=''>状态</option>
						<option value='0'>承保</option>
						<option value='2'>退保</option>
						<option value='3'>失效</option>
					</select>
				</div>
				<div class='layui-input-inline layui-col-sm4 layui-col-md2'>
					<div class="layui-btn-container">
						<button class="layui-btn" lay-submit='' lay-filter='submit'>
							<i class="layui-icon layui-icon-search"></i>查询
						</button>
					</div>
				</div>
			</div>
		</div>
		
		<table class="layui-hide" id="branchTable" lay-filter="test"></table>
	</div>
	<div class='cover' id='cover' style='display: none'>
		<div class='yzr_dialog'>
			<div class='title'>添加人员</div>
			<div class='content'>

			</div>
			<div class='btns'>
				<div class='a'>确定</div>
				<div class='c'>取消</div>
			</div>
		</div>
	</div>
	<div class="excel-cover" style="display: none"></div>
<div class='show-excel-data' style="display: none">
	<div class='inner'>
		<div class="ttl">表格信息</div>
		<table id="excel-table-id">
			<thead>
				<tr>
					<td>申请变更类型</td>
					<td>被保险人姓名</td>
					<td>证件号码</td>
					<td>工种</td>
					<td>性别</td>
					<td>保障方案</td>
					<td>生效日期</td>
					<td>备注</td>
					<td>操作</td>
				</tr>
			</thead>
			<tbody></tbody>
		</table>
		<div class="tip"></div>
		<div class="btns">
			<div class="btn submit" onclick="submitExcel()">提交</div>
			<div class="btn cancel" onclick="hideExcel()">取消</div>
		</div>
	</div>
</div>
<div class='show-excel-data2' style="display: none">
	<div class='inner'>
		<div class="ttl">表格信息</div>
		<table id="excel-table-id2">
			<thead>
				<tr>
					<td>被保险人姓名</td>
					<td>证件号码</td>
					<td>原投保方案</td>
					<td>申请变更方案</td>
					<td>生效日期</td>
					<td>备注</td>
					<td>操作</td>
				</tr>
			</thead>
			<tbody></tbody>
		</table>
		<div class="tip"></div>
		<div class="btns">
			<div class="btn submit" onclick="submitExcel2()">提交</div>
			<div class="btn cancel" onclick="hideExcel()">取消</div>
		</div>
	</div>
</div>
</div>


<!-- <script type="text/html" id="actionBar">
#if(nodeUrl??)#if(nodeUrl.contains("/admin/groupInsurancePerson/view"))
    <a class="layui-btn  layui-btn-xs" lay-event="view">查看</a>
#end#end
		</script>
-->
<!-- 弹框展示excel表格 -->

<style type="text/css">
.show-excel-data{
	position: fixed;
	max-height: 90%;
	max-width: 90%;
	top: 50%;
	left: 50%;
	transform: translate3d(-50%, -50%, 0);
	background: #fff;
	padding: 10px;
	border-radius: 10px;
	border: 1px solid #efefef;
	z-index: 10000000000000000;
}
.show-excel-data .ttl{
	color: #323232;
	font-size: 12px;
	line-height: 16px;
	padding: 5px;
}
.excel-cover{
	position: fixed;
	background: #1c1d1d;
	opacity: 0.8;
	top: 0;
	left: 0;
	bottom: 0;
	right: 0;
	z-index: 99999999999;
}
.show-excel-data #excel-table-id{
	table-layout: fixed;
	border: none;
	border-collapse: collapse;
	width: 100%;
	font-size: 12px;
}
.show-excel-data td{
	border: 1px solid #b6bbbb;
}
.show-excel-data #excel-table-id thead{
	background: #efefef;
}
.show-excel-data #excel-table-id thead td{
	padding: 5px;
	color: #000;
}
.show-excel-data #excel-table-id tbody td{
	padding: 0;
	background: #fff;
}
.show-excel-data #excel-table-id tbody td input{
	padding: 5px;
	font-size: 12px;
	color: #1C1D1D;
	width: 100%;
	box-sizing: border-box;
	outline: none;
	border: none;
}
.show-excel-data .tip{
	line-height: 20px;
	color: #FD482C;
	font-size: 12px;
}
.btns{
	padding: 5px;
	text-align: center;
}
.show-excel-data .btn{
	padding: 2px 10px;
	font-size: 12px;
	line-height: 20px;
	border-radius: 4px;
	display: inline-block;
	margin: 0 10px;
	cursor: pointer;
}
.show-excel-data .btn.ok, .show-excel-data .btn.submit{
	background: #1E9FFF;
	color: #fff;
}
.show-excel-data .btn.cancel{
	color: #323232;
	background: #ededed;
}



.show-excel-data2{
	position: fixed;
	max-height: 90%;
	max-width: 90%;
	top: 50%;
	left: 50%;
	transform: translate3d(-50%, -50%, 0);
	background: #fff;
	padding: 10px;
	border-radius: 10px;
	border: 1px solid #efefef;
	z-index: 10000000000000000;
}
.show-excel-data2 .ttl{
	color: #323232;
	font-size: 12px;
	line-height: 16px;
	padding: 5px;
}
.show-excel-data2 #excel-table-id2{
	table-layout: fixed;
	border: none;
	border-collapse: collapse;
	width: 100%;
	font-size: 12px;
}
.show-excel-data2 td{
	border: 1px solid #b6bbbb;
}
.show-excel-data2 #excel-table-id2 thead{
	background: #efefef;
}
.show-excel-data2 #excel-table-id2 thead td{
	padding: 5px;
	color: #000;
}
.show-excel-data2 #excel-table-id2 tbody td{
	padding: 0;
	background: #fff;
}
.show-excel-data2 #excel-table-id2 tbody td input{
	padding: 5px;
	font-size: 12px;
	color: #1C1D1D;
	width: 100%;
	box-sizing: border-box;
	outline: none;
	border: none;
}
.show-excel-data2 .tip{
	line-height: 20px;
	color: #FD482C;
	font-size: 12px;
}
.btns{
	padding: 5px;
	text-align: center;
}
.show-excel-data2 .btn{
	padding: 2px 10px;
	font-size: 12px;
	line-height: 20px;
	border-radius: 4px;
	display: inline-block;
	margin: 0 10px;
	cursor: pointer;
}
.show-excel-data2 .btn.ok, .show-excel-data2 .btn.submit{
	background: #1E9FFF;
	color: #fff;
}
.show-excel-data2 .btn.cancel{
	color: #323232;
	background: #ededed;
}
</style>
<style>
	.cover{
			position: fixed;
			top: 0;
			left: 0;
			right: 0;
			bottom: 0;
			z-index: 999;
			background-color: rgba(0,0,0,0.3)
		}
		.yzr_dialog{
			width: 660px;
			position: fixed;
			z-index: 99999;
			top: 50%;
			left: 50%;
			transform: translate3d(-50%,-50%,0);
			border: 2px solid #009688;
		}
		.cover .title{
		padding: 0 80px 0 20px;
		height: 42px;
		line-height: 42px;
		border-bottom: 1px solid #eee;
		font-size: 14px;
		color: #fff;
		overflow: hidden;
		background-color: #009688;
		border-radius: 2px 2px 0 0;
		}
		.cover .content{
		background-color: #fff;
		text-align: center;
		}
		.btns{
			text-align: right;
			padding: 0 15px 12px;
			user-select: none;
			-webkit-user-select: none;
			background: #fff;
		}
		.btns .a{
		display: inline-block;
		height: 28px;
		line-height: 28px;
		margin: 5px 5px 0;
		border: 1px solid #1E9FFF;
		background-color: #009688;
		color: #fff;
		border-radius: 2px;
		font-weight: 400;
		cursor: pointer;
		text-decoration: none;
		min-width: 48px;
		text-align: center;
		}
		.btns .c{
		display: inline-block;
		height: 28px;
		line-height: 28px;
		margin: 5px 5px 0;
		border: 1px solid #dedede;
		background-color: #fff;
		color: #333;
		border-radius: 2px;
		font-weight: 400;
		cursor: pointer;
		text-decoration: none;
		min-width: 48px;
		text-align: center;
		}
		.zdy-class-wrap{
			padding: 15px 20px 15px 15px;
		}
		.zdy-class-wrap .layui-formEditPerson{
			padding: 0;
			font-size: 0;
		}
		.zdy-class-wrap .layui-formEditPerson .input .zdy-class-label{
			min-width: 80px;
			line-height: 38px;
			font-weight: 400;
			font-size: 14px;
			color: #333;
			vertical-align: middle;
			
		}
		.zdy-class-wrap .layui-formEditPerson .input th, .zdy-class-wrap .layui-formEditPerson .input td{
			padding-bottom: 5px;
		}
		.zdy-class-wrap .layui-formEditPerson .layui-form-item, .zdy-class-wrap .layui-formEditPerson .layui-inline {
			margin: 0;
		}
		.zdy-class-wrap .layui-formEditPerson table.input{
			width: 100%;
		}
		.zdy-class-wrap .layui-formEditPerson select{
			font-size: 14px;
			color: #121212;
			font-weight: 400;
		}
		.zdy-class-wrap .layui-formEditPerson .theme-required:before{
			display: inline-block;
			content: '';
			width: 5px;
			height: 5px;
			border-radius: 50%;
			background: red;
			vertical-align: 8px;
			margin-right: 3px;
		}
		.layui-layer-dialog{
			border: 2px solid #009688;
		}
		.layui-layer-dialog .layui-layer-title{
			font-size: 14px;
			color: #fff;
			overflow: hidden;
			background-color: #009688;
		}
		.layui-layer-dialog .layui-layer-btn0{
			border: 1px solid #1E9FFF;
			background-color: #009688;
			color: #fff;
		}
		.layui-layer-dialog .layui-layer-close1{
			color: #fff;
		}
</style>
<script type="text/javascript">
	function submitExcel(){
		var data = [];
		
		var $tr = $('#excel-table-id').find("tbody tr");
		
		$tr.each(function(key, val){
			var _data = {}
			$(val).find('input[type=text]').each(function(key,val){
				_data[$(val).attr('name')] = $(val).val();
			})
			data.push(_data)
		})
		dataJson = JSON.stringify(data);
		console.log('data',data);
		
		$.post({
			url: '/admin/groupInsurance/saveExportBatchPersonBtn?hiddenOrderIdForImport=#(orderId)',
			data: dataJson,
			contentType: 'application/json',
			success: function(res){
				res.code || $('.tip').html(res.message);
				
				if(res.code){
					hideExcel();
					location.href="/admin/groupInsurancePerson/addPreserve?id=#(orderId)";
					then(function() { //成功
							form.render() //再选染
						})
						.catch(function(err) { //失败
							console.error('The code from queryPersonByOrderId = ' + err)
						})
				}
			}
		})
		
	}
	function hideExcel(){
		$('.show-excel-data').hide();
		$('.show-excel-data').find('tbody').html('');
		$('.show-excel-data').find('tip').html('');
		$('.excel-cover').hide();
	}
	function hideExcel2(){
		$('.show-excel-data2').hide();
		$('.show-excel-data2').find('tbody').html('');
		$('.show-excel-data2').find('tip').html('');
		$('.excel-cover').hide();
	}
	function submitExcel2(){
		var data = [];
		
		var $tr = $('#excel-table-id2').find("tbody tr");
		
		$tr.each(function(key, val){
			var _data = {}
			$(val).find('input[type=text]').each(function(key,val){
				_data[$(val).attr('name')] = $(val).val();
			})
			data.push(_data)
		})
		dataJson = JSON.stringify(data);
		console.log('data',data);
		
		$.post({
			url: '/admin/groupInsurance/saveChangePersonBtnn?hiddenOrderIdForImport=#(orderId)',
			data: dataJson,
			contentType: 'application/json',
			success: function(res){
				res.code || $('.tip').html(res.message);
				
				if(res.code){
					hideExcel2();
					location.href="/admin/groupInsurancePerson/addPreserve?id=#(orderId)";
					then(function() { //成功
							form.render() //再选染
						})
						.catch(function(err) { //失败
							console.error('The code from queryPersonByOrderId = ' + err)
						})
				}
			}
		})
		
	}
</script>
<script type="text/html" id="headBar">
<div class='layui-btn-container'>
                             <a class="layui-btn layui-btn-sm" id='exportBatchPersonBtn'>
								<i class="layui-icon layui-icon-add-1"></i>保全人员导入
							</a>
	                        <a class="layui-btn layui-btn-sm" id='exportChangePersonBtn'>
								<i class="layui-icon layui-icon-add-1"></i>批量变更层级
							</a>
		                 <a class="layui-btn layui-btn-sm layui-btn-info"  href="../../excel/保全增减员模板.xlsx">
								<i class="layui-icon"></i>保全增减员模板
							</a>
								<a class="layui-btn layui-btn-sm layui-btn-info"  href="../../excel/层级方案变更模板.xlsx">
								<i class="layui-icon"></i>层级方案变更模板
							</a>
					</div>
</script>


 <script type="text/html" id="actionBar">
   #[[
{{#if(d.status==0||d.status==1){ }}
		<a class="layui-btn layui-btn-xs" lay-event="quit">退保</a>
{{#  } else if(d.status==2){ }}
    <a class="layui-btn layui-btn-xs" lay-event="come">进保</a>
  {{#  } }}
<a class="layui-btn layui-btn-xs" lay-event="edit">修改</a>
]]#
		</script>
<script>
	layui.use(['table','layedit','laydate','form'], function(){
	  var table = layui.table
	  ,form = layui.form
	  ,layedit = layui.layedit
	  ,laydate = layui.laydate;
	  
	  layui.use(['element', 'upload'], function() {
			upload = layui.upload;
			//指定允许上传的文件类型
			upload.render({
				elem: '#exportPersonBtn',
				url: '/common/file/upload',
				accept: 'file' //普通文件
					,
				multiple: true,
				done: function(res) {
					var hiddenOrderIdForImport = #(orderId);
					$.ajax({
						type: 'POST',
						url: '/admin/groupInsurance/importPerson',
						data: {
							hiddenOrderIdForImport: hiddenOrderIdForImport,
							filePath: res.data.filePath.trim()
						},
						dataType: "json",
						success: function(data) {
							layer.msg(data.msg);
							if (data.code == 1) {
								  location.href="/admin/groupInsurancePerson/addPreserve?id=#(orderId)";
							}

						}
					});
				}
			})
		})
		
		
			layui.use(['element', 'upload'], function() {
				upload = layui.upload;
				//指定允许上传的文件类型
				upload.render({
					elem: '#exportBatchPersonBtn',
					url: '/common/file/upload',
					accept: 'file' //普通文件
						,
					multiple: true,
					done: function(res) {
						var hiddenOrderIdForImport = #(orderId);
						console.log(hiddenOrderIdForImport);
						$.ajax({
							type: 'POST',
							url: '/admin/groupInsurance/exportBatchPersonBtn',
							data: {
								hiddenOrderIdForImport: hiddenOrderIdForImport,
								filePath: res.data.filePath
							},
							dataType: "json",
							success: function(data) {
							/* 	layer.msg(data.msg);
								if (data.code == 1) {
									location.href="/admin/groupInsurancePerson/addPreserve?id=#(orderId)";
								} */
								// layer.msg(data.msg);
								// if (data.code == ) {
									// reloadPersonTable(data.orderId).
									// then(function() { //成功
									// 		form.render() //再选染
									// 		
									// 		
									// 		
									// 	})
									// 	.catch(function(err) { //失败
									// 		console.error('The code from queryPersonByOrderId = ' + err)
									// 	})
								// }
								function trim(val){
									return val == null ? '' : val
								}
								var html = '';
								data.persons.forEach(function(person, index) {
									html += '<tr><td>'+
										"<input type='text' name='status' groupInsurancePersonStatus id='' value='" + trim(person.statusStr) + "' />"+
										"</td><td>"+
											"<input type='text' name='name' groupInsurancePersonName id='' value='" + trim(person.name) + "' />"+
										"</td><td>"+
											"<input type='text' name='id_num' groupInsurancePersonId_num id='' value='" + trim(person.id_num) + "' />"+
										"</td><td>"+
											"<input type='text' name='job_type' groupInsurancePersonJob_type id='' value='" + trim(person.job_type )+ "' />"+
										"</td><td>"+
											"<input type='text' name='gender' groupInsurancePersonGender id='' value='" + trim(person.genderStr) + "' />"+
										"</td><td>"+
											"<input type='text' name='guarantee_id' groupInsurancePersonGuarantee_id id='' value='" + trim(person.guarantee_name) + "' />"+
										"</td><td>"+
											"<input type='text' name='policy_effective_date' groupInsurancePersonPolicy_effective_date id='' value='" + trim(person.policy_effective_date) + "' />"+
										"</td><td>"+
										"<input type='text' name='remark' groupInsurancePersonRemark id='' value='" + trim(person.remark) + "' />"+
										"</td><td>"+
										"<div class='btn ok'"  +
											
											" data-name='"+ trim(person.name) + "' data-status='"+ trim(person.status) + "' data-job_type='"+ trim(person.job_type) + "' data-gender='"+ trim(person.gender) + "' data-id_type='" + trim(person.id_type) + "' data-id_num='" + trim(person.id_num) + "' data-phone='" + trim(person.phone) + "' data-occupation_category='" + trim(person.occupation_category) + "' data-guarantee_id='" + trim(person.guarantee_id) + "' data-remark='" + trim(person.remark) + "' data-policy_effective_date='" + trim(person.policy_effective_date) + "' data-policy_expiration_date='" + trim(person.policy_expiration_date) + "' data-policy_num='" + trim(person.policy_num) + "' data-id='" + trim(person.id) + "'" +
											
											" >修改</div>" +
										
										"</td></tr>"
								})
								$('.show-excel-data').show();
								$('.excel-cover').show();
								$('.show-excel-data').find('tbody').append(html)
								$('.show-excel-data').find('.tip').html(data.message)
								$('.show-excel-data').find('.btn.ok').click(editPersonFunc1)
							}
						});
					}
				})
			})

			layui.use(['element', 'upload'], function() {
				upload = layui.upload;
				//指定允许上传的文件类型
				upload.render({
					elem: '#exportChangePersonBtn',
					url: '/common/file/upload',
					accept: 'file' //普通文件
						,
					multiple: true,
					done: function(res) {
						var hiddenOrderIdForImport =#(orderId);
						console.log(hiddenOrderIdForImport);
						if (hiddenOrderIdForImport == undefined || hiddenOrderIdForImport == null || hiddenOrderIdForImport == "") {
							layer.msg("请先保存产品保障说明！");
							return false;
						}
						$.ajax({
							type: 'POST',
							url: '/admin/groupInsurance/exportChangePersonBtn',
							data: {
								hiddenOrderIdForImport: hiddenOrderIdForImport,
								filePath: res.data.filePath
							},
							dataType: "json",
							success: function(data) {
								/* layer.msg(data.msg);
								if (data.code == 1) {
									  location.href="/admin/groupInsurancePerson/addPerson?id=#(orderId)";
								} */
								// layer.msg(data.msg);
								// if (data.code == ) {
									// reloadPersonTable(data.orderId).
									// then(function() { //成功
									// 		form.render() //再选染
									// 		
									// 		
									// 		
									// 	})
									// 	.catch(function(err) { //失败
									// 		console.error('The code from queryPersonByOrderId = ' + err)
									// 	})
								// }
								function trim(val){
									return val == null ? '' : val
								}
								var html = '';
								data.persons.forEach(function(person, index) {
									html += '<tr><td>'+
										"<input type='text' name='name' groupInsurancePersonName id='' value='" + trim(person.name) + "' />"+
										"</td><td>"+
											"<input type='text' name='id_num' groupInsurancePersonId_num id='' value='" + trim(person.id_num )+ "' />"+
										"</td><td>"+
											"<input type='text' name='oldPlan' groupInsurancePersonOldPlan='' value='" + trim(person.oldPlan) + "' /><input type='text' name='oldPlanId'  id='' value='" + trim(person.oldPlanId) + "' />"+
										"</td><td>"+
											"<input type='text' name='newPlan' groupInsurancePersonNew_plan id='' value='" + trim(person.newPlan) + "' /><input type='text' name='newPlanId'  id='' value='" + trim(person.newPlanId) + "' />"+
										"</td><td>"+
											"<input type='text' name='policy_effective_date' groupInsurancePersonPolicy_effective_date id='' value='" + trim(person.policy_effective_date) + "' />"+
										"</td><td>"+
											"<input type='text' name='policy_num' groupInsurancePersonPolicy_num  id='' value='" + trim(person.policy_num) + "' />"+
										"</td><td>"+
										"<div class='btn ok'"  +
											
											" data-name='"+ trim(person.name) +  "' data-oldPlanId='"+ trim(person.oldPlanId) + "'  data-newPlanId='"+ trim(person.newPlanId) + "'  data-gender='"+ trim(person.gender) + "'  data-status='"+ trim(person.status) + "'  data-id_type='" + trim(person.id_type) + "' data-id_num='" + trim(person.id_num) + "' data-phone='" + trim(person.phone) + "' data-occupation_category='" + trim(person.occupation_category) + "' data-guarantee_id='" + trim(person.guarantee_id) + "' data-remark='" + trim(person.remark) + "' data-policy_effective_date='" + trim(person.policy_effective_date) + "' data-policy_expiration_date='" + trim(person.policy_expiration_date) + "' data-job_type='"+ trim(person.job_type) + "'  data-policy_num='" + trim(person.policy_num) + "' data-id='" + trim(person.id) + "'" +
											
											" >修改</div>" +
										
										"</td></tr>"
								})
								$('.show-excel-data2').show();
								$('.excel-cover').show();
								$('.show-excel-data2').find('tbody').append(html)
								$('.show-excel-data2').find('.tip').html(data.message)
								$('.show-excel-data2').find('.btn.ok').click(editPersonFunc2)
							}
						});
					}
				})
			})
	 var branchTable =  table.render({
	    elem: '#branchTable'
	    ,url:'/admin/groupInsurancePerson/selectByPage?orderId=#(orderId)'
	    ,cellMinWidth: 80
	    ,toolbar: '#headBar'
	    ,defaultToolbar: ['filter','print','exports']
	    ,title: ''
	    ,cols: [[
		  // {field:'status', title:'状态'},
	      {field:'name', title:'姓名'}
	      ,{field:'id_num', title:'身份证'}
	      ,{field:'policy_num', title:'保单号'}
	      ,{field:'customerName', title:'客户名称'}
	      ,{field:'premium', title:'保费',templet:function (item) {
	    	  var premium=item.premium.toFixed(2);
	    	  return premium;
	    	  }
	      }
    	  ,{field:'occupation_category', title:'职业类别'}
	      ,{field:'status', title:'状态'}
	    
	      ,{fixed: 'right', title:'操作',width : 150,align : 'center', toolbar: '#actionBar'}
	    ]]
	 ,done: function(res, page, count){
			$("[data-field='status']").children().each(function(){
				if($(this).text()=='0'){
					   $(this).html("<span>承保<span>");
					}else if($(this).text()=='2'){
						   $(this).html("<span>退保<span>");
					}
					else if($(this).text()=='3'){
						   $(this).html("<span>失效<span>");
					}
			})
	 }
	    ,page: true
	  });
	  

	  //监听行工具事件
	  table.on('toolbar(test)', function(obj){
	    var data = obj.data; 
	    var hiddenOrderId = #(orderId);
	    if(obj.event === 'addPreserveBtn'){
	    	//查询保障方案
			$.ajax({
				type: 'GET',
				url: "/admin/groupInsurance/findGuaranteeSchemes",
				data: {
					orderId: hiddenOrderId
				},
				dataType: "json",
				success: function(data) {
					var selectHtml =
						'<select name="groupInsurancePerson.guarantee_id" class="layui-input"><option value="">选择</option>';
					$.each(data.guarantees, function(key, val) {
						selectHtml += '<option value="' + key + '">' + val + '</option>';
					});
					selectHtml += '</select>';
					var html =
						'<div class="layui-tab-item layui-show zdy-class-wrap"><form class="layui-tab-content layui-form6" action="/admin/groupInsurance/addPreserve">' +
						'<input type="hidden" name="hiddenOrderId" value="' + hiddenOrderId + '" /> ' +
						'<div class="layui-form-item"><table class="input"> ' +
						'<tr>' +
						'<th class="zdy-class-label">' +
						'<div class="layui-inline theme-required">姓名</div></div>' +
						'</th>' +
						'<td>' +
						'<input type="text" name="groupInsurancePerson.name" class="layui-input" maxlength="50" />' +
						'</td>' +
						'<th class="zdy-class-label">' +
						'<div class="layui-form-item"><div class="layui-inline theme-required">性别</div></div>' +
						'</th>' +
						'<td>' +
						'<select name="groupInsurancePerson.gender" class="layui-input">' +
						'<option value="">请选择</option>' +
						'<option value="1">男</option>' +
						'<option value="0">女</option>' +
						'</select>' +
						'</td>' +
						'</tr>' +
						'<tr>' +
						'<th class="zdy-class-label">' +
						'<div class="layui-form-item"><div class="layui-inline theme-required"><span style="color:red">*</span>证件类型</div></div>' +
						'</th>' +
						'<td>' +
						'<select name="groupInsurancePerson.id_type" class="layui-input">' +
						'<option value="">请选择</option>' +
						'<option value="0">身份证</option>' +
						'<option value="1">出生证</option>' +
						'<option value="2">护照</option>' +

						'</select>' +
						'</td>' +
						'<th class="zdy-class-label">' +
						'<div class="layui-form-item"><div class="layui-inline theme-required"><span style="color:red">*</span>证件号码</div></div>' +
						'</th>' +
						'<td>' +
						'<input type="text" name="groupInsurancePerson.id_num" class="layui-input" maxlength="30" />' +
						'</td>' +
						'</tr>' +
						'<tr>' +
						'<th class="zdy-class-label">' +
						'联系电话' +
						'</th>' +
						'<td>' +
						'<input type="text" name="groupInsurancePerson.phone" class="layui-input" maxlength="20" />' +
						'</td>' +
						'<th class="zdy-class-label">' +
						'职业类别' +
						'</th>' +
						'<td>' +
						'<select name="groupInsurancePerson.occupation_category" class="layui-input">' +
						'<option value="">请选择</option>' +
						'<option value="1">1</option>' +
						'<option value="2">2</option>' +
						'<option value="3">3</option>' +
						'<option value="4">4</option>' +
						'<option value="5">5</option>' +
						'<option value="6">6</option>' +
						'</select>' +
						'</td>' +
						'</tr>' +
						'<tr>' +
						'<th class="layui-inline theme-required zdy-class-label">' +
						'保障方案' +
						'</th>' +
						'<td>' + selectHtml + '' +
						'</td>' +
						'<th class="zdy-class-label">' +
						'备注' +
						'</th>' +
						'<td>' +
						'<input type="text" name="groupInsurancePerson.remark" class="layui-input" maxlength="200" />' +
						'</td>' +
						'</tr>' +
						'<tr>' +
						'<th class="layui-inline theme-required zdy-class-label">' +
						'生效日期' +
						'</th>' +
						'<td><input type="text" name="groupInsurancePerson.policy_effective_date" id="person_policy_effective_date" class="layui-input" maxlength="200" />' +
						'</td>' +
						'<th class="layui-inline theme-required zdy-class-label">' +
						'终止日期' +
						'</th>' +
						'<td>' +
						'<input type="text" name="groupInsurancePerson.policy_expiration_date" id="person_policy_expiration_date" class="layui-input" maxlength="200" />' +
						'</td>' +
						'</tr>' +
						'<tr>' +
						'<th class="zdy-class-label">' +
						'保单号' +
						'</th>' +
						'<td>' +
						'<input type="text" name="groupInsurancePerson.policy_num" class="layui-input" maxlength="200" />' +
						'</td>' +
						'<th class="zdy-class-label">' +
						'工种' +
						'</th>' +
						'<td>' +
						'<input type="text" name="groupInsurancePerson.job_type" id="job_type" class="layui-input" maxlength="200" />' +
						'</td>' +
						'</tr>' +
						'</table></div>' +
						'</form></div>';
					/*        	layer.open({
		        		  title: '添加人员'
		        	      ,area: ['660px', '300px']
		        	      ,btn: ['确定', '取消']
		        		  ,content: html
		        		  ,yes: function(index, layero){
		        			  $.post($(".layui-form4").attr('action'), $(".layui-form4").serialize(),
		        						function(res) {
		        							layer.msg(res.msg); 
		        				    		if(res.code == 1) {
		        				    			reloadPersonTable(hiddenOrderId);
		        				    		}
		        						}, "json");
		        			  
		        			  }
		        	      ,no: function(index, layero){
		        	    	  layer.close(index);
	     			  }
		        		});      */
					cover.find('.content').html(html);
					cover.show();
					form.render();

					laydate.render({
						elem: '#person_policy_effective_date',
						trigger: 'click'
					});
					laydate.render({
						elem: '#person_policy_expiration_date',
						trigger: 'click'
					});
				}
			});

		var cover = $('#cover')
		cover.find('.a').click(function() {
			var hiddenOrderId = $("input[name='hiddenOrderIdForGuarantee3']").val();
			$.post($(".layui-form6").attr('action'), $(".layui-form6").serialize(),
				function(res) {
					layer.msg(res.msg);
					if (res.code == 1) {
							cover.hide()
						  location.href="/admin/groupInsurancePerson/addPreserve?id=#(orderId)";
  
					}
				}, "json");
		})
		cover.find('.c').click(function() {
			cover.hide()
		})
	    }
	    else  if(obj.event === 'exportPersonBtn'){
	    }
	    else  if(obj.event === '22'){
	    	console.log('view')
			  location.href="/admin/groupInsurancePerson/view?id="+data.id;
	    }
	  });
	  
	  //监听行工具事件
	  table.on('tool(test)', function(obj){
	    var data = obj.data;
	    if(obj.event === 'come'){
	    	var personId = data.id;
			var hiddenOrderId = #(orderId);
			$.post("/admin/groupInsurance/comePerson", {
					personId: personId
				},
				function(res) {
					layer.msg(res.msg);
					if (res.code == 1) {
						 location.href="/admin/groupInsurancePerson/addPreserve?id=#(orderId)";
					}
				}, "json");
			
	    }
	    else if(obj.event === 'quit'){
	    	var personId = data.id;
			var hiddenOrderId = #(orderId);
			$.post("/admin/groupInsurance/cancelPerson", {
					personId: personId
				},
				function(res) {
					layer.msg(res.msg);
					if (res.code == 1) {
						 location.href="/admin/groupInsurancePerson/addPreserve?id=#(orderId)";
					}
				}, "json");
	    }
	    else if(obj.event === 'edit'){
	    	var personId = data.id;
			var name = data.name;
			var gender = data.gender;
			var idType = data.id_type;
			var idNum = data.id_num
			var phone = data.phone;
			var occupationCategory = data.occupation_category;
			var plan = data.guarantee_id; 
			var remark = data.remark;
			var policy_effective_date = data.policy_effective_date
			var policy_expiration_date = data.policy_expiration_date;
			var policy_num = data.policy_num;
			var hiddenOrderId = #(orderId);
			$.ajax({
				type: 'GET',
				url: "/admin/groupInsurance/findGuaranteeSchemes",
				data: {
					orderId: hiddenOrderId
				},
				dataType: "json",
				success: function(data) {
					var selectHtml =
						'<select name="groupInsurancePerson.guarantee_id" class="layui-input"><option value="">选择</option>';
					$.each(data.guarantees, function(key, val) {
						if (key == plan) {
							selectHtml += '<option value="' + key + '" selected="selected">' + val + '</option>';
						} else {
							selectHtml += '<option value="' + key + '">' + val + '</option>';
						}
					});
					selectHtml += '</select>';
					var html = '<div class="layui-tab-item layui-show zdy-class-wrap"><form class="layui-tab-content layui-formEditPerson" action="/admin/groupInsurance/addPerson">' +
						'<input type="hidden" name="hiddenOrderId" value="' + hiddenOrderId + '" /> <table class="input"> ' +
						'<tr>' +
						'<th class="layui-inline theme-required zdy-class-label">' +
						'<div class="layui-inline">姓名</div>' +
						'</th>' +
						'<td>' +
						'<input type="text" name="groupInsurancePerson.id" value="' + personId +
						'" class="layui-input" style="display:none;" maxlength="50" /><input type="text" name="groupInsurancePerson.name" value="' +
						name + '" class="layui-input" maxlength="50" />' +
						'</td>' +
						'<th class="layui-inline theme-required zdy-class-label">' +
						'<div class="layui-inline">性别</div>' +
						'</th>' +
						'<td>' +
						'<select name="groupInsurancePerson.gender" class="layui-input">' +
						'<option value="">请选择</option><option value="1"';
					if (gender == 1) {
						html += 'selected';
					}
					html += '>男</option><option value="0"';
					if (gender == 0) {
						html += 'selected';
					}
					html += '>女</option>';
					html += '</select>' +
						'</td>' +
						'</tr>' +
						'<tr>' +
						'<th class="layui-inline theme-required zdy-class-label">' +
						'<div class="layui-inline">证件类型</div>' +
						'</th>' +
						'<td>' +
						'<select name="groupInsurancePerson.id_type" class="layui-input">' +
						'<option value="">请选择</option><option value="0"';
					if (idType == 0) {
						html += 'selected';
					}
					html += '>身份证</option><option value="1"';
					if (idType == 1) {
						html += 'selected';
					}
					html += '>出生证</option><option value="2"';
					if (idType == 2) {
						html += 'selected';
					}
					html += '>护照</option>';
					html += '</select>' +
						'</td>' +
						'<th class="layui-inline theme-required zdy-class-label">' +
						'<div class="layui-inline">证件号码</div>' +
						'</th>' +
						'<th>' +
						'<input type="text" name="groupInsurancePerson.id_num" value="' + idNum +
						'" class="layui-input" maxlength="30" />' +
						'</th>' +
						'</tr>' +
						'<tr>' +
						'<th class="zdy-class-label">' +
						'联系电话' +
						'</th>' +
						'<td>' +
						'<input type="text" name="groupInsurancePerson.phone" value="' + phone +
						'" class="layui-input" maxlength="20" />' +
						'</td>' +
						'<th class="zdy-class-label">' +
						'职业类别' +
						'</th>' +
						'<td>' +
						'<select name="groupInsurancePerson.occupation_category" class="layui-input">' +
						'<option value="">请选择</option><option value="1"';
					if (occupationCategory == 1) {
						html += 'selected';
					}
					html += '>1</option><option value="2"';
					if (occupationCategory == 2) {
						html += 'selected';
					}
					html += '>2</option><option value="3"';
					if (occupationCategory == 3) {
						html += 'selected';
					}
					html += '>3</option><option value="4"';
					if (occupationCategory == 4) {
						html += 'selected';
					}
					html += '>4</option><option value="5"';
					if (occupationCategory == 5) {
						html += 'selected';
					}
					html += '>5</option><option value="6"';
					if (occupationCategory == 6) {
						html += 'selected';
					}
					html += '>6</option>';
					html += '</select>' +
						'</td>' +
						'</tr>' +
						'<tr>' +
						'<th class="layui-inline theme-required zdy-class-label">' +
						'保障方案' +
						'</th>' +
						'<td>' + selectHtml + '' +
						'</td>' +
						'<th class="zdy-class-label">' +
						'备注' +
						'</th>';
					if (remark == null || remark == "null") {
						html += '<th>' +
							'<input type="text" name="groupInsurancePerson.remark" value="" class="layui-input" maxlength="200" />' +
							'</th>';
					} else {
						html += '<th>' +
							'<input type="text" name="groupInsurancePerson.remark" value="' + remark +
							'" class="layui-input" maxlength="200" />' +
							'</th>';
					}
					html += '</tr>' +
						'<tr>' +
						'<th class="layui-inline theme-required zdy-class-label">' +
						'生效日期' +
						'</th>' +
						'<td><input type="text" name="groupInsurancePerson.policy_effective_date" value="' + policy_effective_date +
						'"   class="layui-input person_policy_effective_date" maxlength="200" />' +
						'</td>' +
						'<th class="layui-inline theme-required zdy-class-label">' +
						'终止日期' +
						'</th>' +
						'<th>' +
						'<input type="text" name="groupInsurancePerson.policy_expiration_date" value="' + policy_expiration_date +
						'"   class="layui-input person_policy_expiration_date" maxlength="200" />' +
						'</th>' +
						'</tr>' +
						'<tr>' +
						'<th class="zdy-class-label">' +
						'保单号' +
						'</th>' +
						'<th>' +
						'<input type="text" name="groupInsurancePerson.policy_num" class="layui-input" value="' + policy_num +
						'" maxlength="200" />' +
						'</th>' +
						'</tr>' +
						'</table>' +
						'</form>' +
						'</div>';
					layer.open({
						title: '修改人员',
						area: ['660px', '400px'],
						btn: ['确定', '取消'],
						content: html,
						yes: function(index, layero) {
							$.post($(".layui-formEditPerson").attr('action'), $(".layui-formEditPerson").serialize(),
								function(res) {
									layer.msg(res.msg);
									if (res.code == 1) {
										location.href="/admin/groupInsurancePerson/addPreserve?id=#(orderId)";
									}
								}, "json");

						},
						no: function(index, layero) {
							layer.close(index);
						}
					});
					form.render();

					laydate.render({
						elem: '.person_policy_effective_date',
						format: 'yyyy-MM-dd HH:mm:ss',
						trigger: 'click'
					});
					laydate.render({
						elem: '.person_policy_expiration_date',
						format: 'yyyy-MM-dd HH:mm:ss',
						trigger: 'click'
					});
				}
			});
	    }
	  });
	  
	  function editPersonFunc1() {
			var personId = $(this).attr("data-id");
			console.log('$(this)',$(this));
			console.log('personId',personId)
			var name = $(this).attr("data-name");
			var status=$(this).attr("data-status");
			var gender = $(this).attr("data-gender");
			var idType = $(this).attr("data-id_type");
			var idNum = $(this).attr("data-id_num");
			var phone = $(this).attr("data-phone");
			var occupationCategory = $(this).attr("data-occupation_category");
			var plan = $(this).attr("data-guarantee_id");
			var remark = $(this).attr("data-remark");
			var policy_effective_date = $(this).attr("data-policy_effective_date");
			var policy_expiration_date = $(this).attr("data-policy_expiration_date");
			var policy_num = $(this).attr("data-policy_num");
			var job_type = $(this).attr("data-job_type");
			var hiddenOrderId = #(orderId);
			var that = this;
			var guarantee;
			$.ajax({
				type: 'GET',
				url: "/admin/groupInsurance/findGuaranteeSchemes",
				data: {
					orderId: hiddenOrderId
				},
				dataType: "json",
				success: function(data) {
					var selectHtml =
						'<select name="groupInsurancePerson.guarantee_id" class="layui-input"><option value="">选择</option>';
					$.each(data.guarantees, function(key, val) {
						guarantee=data;
						if (key == plan) {
							selectHtml += '<option value="' + key + '" selected="selected">' + val + '</option>';
						} else {
							selectHtml += '<option value="' + key + '">' + val + '</option>';
						}
					});
					selectHtml += '</select>';
					var html = '<form class="layui-tab-content layui-formEditPerson" action="/admin/groupInsurance/addPerson">' +
						'<input type="hidden" name="hiddenOrderId" value="' + hiddenOrderId + '" /> <table class="input"> ' +
						'<tr>' +
						'<th>' +
						'<div class="layui-form-item"><div class="layui-inline theme-required"><span style="color:red">*</span>姓名</div></div>' +
						'</th>' +
						'<td>' +
						'<input type="text" name="groupInsurancePerson.id" value="' + personId +
						'" class="layui-input" style="display:none;" maxlength="50" /><input type="text" name="groupInsurancePerson.name" value="' +
						name + '" class="layui-input" maxlength="50" />' +
						'</td>' +
						'<th>' +
						'<div class="layui-form-item"><div class="layui-inline theme-required">申请类型</div></div>' +
						'</th>' +
						'<td>' +
						'<select name="groupInsurancePerson.status" class="layui-input">' +
						'<option value="">请选择</option><option value="0"';
					if (status == 0) {
						html += 'selected';
					}
					html += '>加保</option><option value="2"';
					if (status == 2) {
						html += 'selected';
					}
					html += '>减保</option>';
					html += '</select>' +
						'</td>' +
						'</tr>' +
						'<tr>' +
						'<th>' +
						'<div class="layui-form-item"><div class="layui-inline theme-required"><span style="color:red">*</span>证件类型</div></div>' +
						'</th>' +
						'<td>' +
						'<select name="groupInsurancePerson.id_type" class="layui-input">' +
						'<option value="">请选择</option><option value="0"';
				 	if (idType == 0) {
						html += 'selected';
					} 
					html += '>身份证</option>';
					/* if (idType == 0) {
						html += 'selected </option>';
					}  */
					/* html += '>出生证</option><option value="2"';
					if (idType == 2) {
						html += 'selected';
					}
					html += '>护照</option>'; */
					html += '</select>' +
						'</td>' +
						'<th>' +
						'<div class="layui-form-item"><div class="layui-inline theme-required"><span style="color:red">*</span>证件号码</div></div>' +
						'</th>' +
						'<th>' +
						'<input type="text" name="groupInsurancePerson.id_num" value="' + idNum +
						'" class="layui-input" maxlength="30" />' +
						'</th>' +
						'</tr>' +
						/* '<tr>' +
						'<th>' +
						'联系电话' +
						'</th>' +
						'<td>' +
						'<input type="text" name="groupInsurancePerson.phone" value="' + phone +
						'" class="layui-input" maxlength="20" />' +
						'</td>' +
						'<th>' +
						'职业类别' +
						'</th>' +
						'<td>' +
						'<select name="groupInsurancePerson.occupation_category" class="layui-input">' +
						'<option value="">请选择</option><option value="1"';
					if (occupationCategory == 1) {
						html += 'selected';
					}
					html += '>1</option><option value="2"';
					if (occupationCategory == 2) {
						html += 'selected';
					}
					html += '>2</option><option value="3"';
					if (occupationCategory == 3) {
						html += 'selected';
					}
					html += '>3</option><option value="4"';
					if (occupationCategory == 4) {
						html += 'selected';
					}
					html += '>4</option><option value="5"';
					if (occupationCategory == 5) {
						html += 'selected';
					}
					html += '>5</option><option value="6"';
					if (occupationCategory == 6) {
						html += 'selected';
					}
					html += '>6</option>';
					html += '</select>' +
						'</td>' +
						'</tr>' + */
						'<tr>' +
						'<th>' +
						'<span style="color:red">*</span>保障方案' +
						'</th>' +
						'<td>' + selectHtml + '' +
						'</td>' +
						'<th>' +
						'备注' +
						'</th>';
					if (remark == null || remark == "null") {
						html += '<th>' +
							'<input type="text" name="groupInsurancePerson.remark" value="" class="layui-input" maxlength="200" />' +
							'</th>';
					} else {
						html += '<th>' +
							'<input type="text" name="groupInsurancePerson.remark" value="' + remark +
							'" class="layui-input" maxlength="200" />' +
							'</th>';
					}
					html += '</tr>' +
						'<tr>' +
						'<th>' +
						'<span style="color:red">*</span>生效日期' +
						'</th>' +
						'<td><input type="text" name="groupInsurancePerson.policy_effective_date"  timeFormat="yyyy-MM-dd" value="' + policy_effective_date +
						'"   class="layui-input person_policy_effective_date" maxlength="200" />' +
						'</td>' +
						'<th>' +
						'<span style="color:red">*</span>终止日期' +
						'</th>' +
						'<th>' +
						'<input type="text" name="groupInsurancePerson.policy_expiration_date"  timeFormat="yyyy-MM-dd" value="' + policy_expiration_date +
						'"   class="layui-input person_policy_expiration_date" maxlength="200" />' +
						'</th>' +
						'</tr>' +
						'<tr>' +
						'<th>' +
						'保单号' +
						'</th>' +
						'<th>' +
						'<input type="text" name="groupInsurancePerson.policy_num" class="layui-input" value="' + policy_num +
						'" maxlength="200" />' +
						'</th>' +
						'</tr>' +
						'<tr>' +
						'<th>' +
						'工种' +
						'</th>' +
						'<th>' +
						'<input type="text" name="groupInsurancePerson.job_type" class="layui-input" value="' + job_type +
						'" maxlength="200" />' +
						'</th>' +
						'</tr>' +
						'</table>' +
						'</form>';
					layer.open({
						title: '修改人员',
						area: ['660px', '400px'],
						btn: ['确定', '取消'],
						content: html,
						yes: function(index, layero) {
							// $.post($(".layui-formEditPerson").attr('action'), $(".layui-formEditPerson").serialize(),
							// 	function(res) {
							// 		layer.msg(res.msg);
							// 		if (res.code == 1) {
							// 			reloadPersonTable(hiddenOrderId).then(function() {
							// 				form.render()
							// 				cover.hide()
							// 			})
							// 		}
							// 	}, "json");
							var result = {}
							$(".layui-formEditPerson").serialize().split('&').forEach(function(item, index) {
								var key_val = item.split('=')
								result[key_val[0]] = decodeURIComponent(key_val[1])
							})
							
							console.log('result',result);
							console.log('guarantee',guarantee);
							var $tr = $(that).closest('tr');
							for(var key in result){
								// console.log('key',key);
								var _key = key;
								if(key.indexOf('.') > -1){
									key = key.split('.');
									key = key[0] + key[1].substr(0,1).toUpperCase() + key[1].slice(1);
								}
								// console.log('key',key);
								var $td =	$tr.find("["+ key + "]");
								// console.log('$td',$td);
								if(key == 'groupInsurancePersonGender'){
									$td.val(result[_key] == '1' ? '男' : '女');
									//return
									continue;
								}
								if(key == 'groupInsurancePersonId_type'){
									$td.val(result[_key] == '0' ? '身份证' : '');
									//return;
									continue;
								}
								if(key == 'groupInsurancePersonStatus'){
									$td.val(result[_key] == '0' ? '加保' : '减保');
									//return;
									continue;
								}
								if(key == 'groupInsurancePersonGuarantee_id'){
									$.each(guarantee.guarantees, function(key, val) {
										guarantee=data;
										if (key == result[_key]) {
											$td.val(val);									} 
									});
									continue;
								}
								$td.val(result[_key])
								layer.close(index);
							}
							
						},
						no: function(index, layero) {
							layer.close(index);
						}
					});
					form.render();
		
					laydate.render({
						elem: '.person_policy_effective_date',
						format: 'yyyy-MM-dd HH:mm:ss',
						trigger: 'click'
					});
					laydate.render({
						elem: '.person_policy_expiration_date',
						format: 'yyyy-MM-dd HH:mm:ss',
						trigger: 'click'
					});
				}
			});
		}
		
	  
	  function editPersonFunc2() {
			var personId = $(this).attr("data-id");
			console.log('$(this)',$(this));
			console.log('personId',personId)
			var name = $(this).attr("data-name");
			var status=$(this).attr("data-status");
			var gender = $(this).attr("data-gender");
			var idType = $(this).attr("data-id_type");
			var idNum = $(this).attr("data-id_num");
			var phone = $(this).attr("data-phone");
			var occupationCategory = $(this).attr("data-occupation_category");
			var plan = $(this).attr("data-guarantee_id");
			var remark = $(this).attr("data-remark");
			var policy_effective_date = $(this).attr("data-policy_effective_date");
			var policy_expiration_date = $(this).attr("data-policy_expiration_date");
			var policy_num = $(this).attr("data-policy_num");
			var job_type = $(this).attr("data-job_type");
			var hiddenOrderId = #(orderId);
			var that = this;
			var guarantee;
			$.ajax({
				type: 'GET',
				url: "/admin/groupInsurance/findGuaranteeSchemes",
				data: {
					orderId: hiddenOrderId
				},
				dataType: "json",
				success: function(data) {
					var selectHtml =
						'<select name="groupInsurancePerson.new_plan" class="layui-input"><option value="">选择</option>';
					$.each(data.guarantees, function(key, val) {
						guarantee=data;
						if (key == plan) {
							selectHtml += '<option value="' + key + '" selected="selected">' + val + '</option>';
						} else {
							selectHtml += '<option value="' + key + '">' + val + '</option>';
						}
					});
					selectHtml += '</select>';
					var html = '<form class="layui-tab-content layui-formEditPerson" action="/admin/groupInsurance/addPerson">' +
						'<input type="hidden" name="hiddenOrderId" value="' + hiddenOrderId + '" /> <table class="input"> ' +
						'<tr>' +
						'<th>' +
						'<div class="layui-form-item"><div class="layui-inline theme-required"><span style="color:red">*</span>姓名</div></div>' +
						'</th>' +
						'<td>' +
						'<input type="text" name="groupInsurancePerson.id" value="' + personId +
						'" class="layui-input" style="display:none;" maxlength="50" /><input type="text" name="groupInsurancePerson.name" value="' +
						name + '" class="layui-input" maxlength="50" />' +
						'</td>' +
						'<th>' +
						'保单号' +
						'</th>' +
						'<th>' +
						'<input type="text" name="groupInsurancePerson.policy_num" class="layui-input" value="' + policy_num +
						'" maxlength="200" />' +
						'</th>' +
						'</tr>' +
						'<tr>' +
						'<th>' +
						'<div class="layui-form-item"><div class="layui-inline theme-required"><span style="color:red">*</span>证件类型</div></div>' +
						'</th>' +
						'<td>' +
						'<select name="groupInsurancePerson.id_type" class="layui-input">' +
						'<option value="">请选择</option><option value="0"';
				 	if (idType == 0) {
						html += 'selected';
					} 
					html += '>身份证</option>';
					/* if (idType == 0) {
						html += 'selected </option>';
					}  */
					/* html += '>出生证</option><option value="2"';
					if (idType == 2) {
						html += 'selected';
					}
					html += '>护照</option>'; */
					html += '</select>' +
						'</td>' +
						'<th>' +
						'<div class="layui-form-item"><div class="layui-inline theme-required"><span style="color:red">*</span>证件号码</div></div>' +
						'</th>' +
						'<th>' +
						'<input type="text" name="groupInsurancePerson.id_num" value="' + idNum +
						'" class="layui-input" maxlength="30" />' +
						'</th>' +
						'</tr>' +
						/* '<tr>' +
						'<th>' +
						'联系电话' +
						'</th>' +
						'<td>' +
						'<input type="text" name="groupInsurancePerson.phone" value="' + phone +
						'" class="layui-input" maxlength="20" />' +
						'</td>' +
						'<th>' +
						'职业类别' +
						'</th>' +
						'<td>' +
						'<select name="groupInsurancePerson.occupation_category" class="layui-input">' +
						'<option value="">请选择</option><option value="1"';
					if (occupationCategory == 1) {
						html += 'selected';
					}
					html += '>1</option><option value="2"';
					if (occupationCategory == 2) {
						html += 'selected';
					}
					html += '>2</option><option value="3"';
					if (occupationCategory == 3) {
						html += 'selected';
					}
					html += '>3</option><option value="4"';
					if (occupationCategory == 4) {
						html += 'selected';
					}
					html += '>4</option><option value="5"';
					if (occupationCategory == 5) {
						html += 'selected';
					}
					html += '>5</option><option value="6"';
					if (occupationCategory == 6) {
						html += 'selected';
					}
					html += '>6</option>';
					html += '</select>' +
						'</td>' +
						'</tr>' + */
						'<tr>' +
						'<th>' +
						'<span style="color:red">*</span>保障方案' +
						'</th>' +
						'<td>' + selectHtml + '' +
						'</td>' +
						'<th>' +
						'备注' +
						'</th>';
					if (remark == null || remark == "null") {
						html += '<th>' +
							'<input type="text" name="groupInsurancePerson.remark" value="" class="layui-input" maxlength="200" />' +
							'</th>';
					} else {
						html += '<th>' +
							'<input type="text" name="groupInsurancePerson.remark" value="' + remark +
							'" class="layui-input" maxlength="200" />' +
							'</th>';
					}
					html += '</tr>' +
						'<tr>' +
						'<th>' +
						'<span style="color:red">*</span>生效日期' +
						'</th>' +
						'<td><input type="text" name="groupInsurancePerson.policy_effective_date"  timeFormat="yyyy-MM-dd" value="' + policy_effective_date +
						'"   class="layui-input person_policy_effective_date" maxlength="200" />' +
						'</td>' +
						'<th>' +
						'<span style="color:red">*</span>终止日期' +
						'</th>' +
						'<th>' +
						'<input type="text" name="groupInsurancePerson.policy_expiration_date"  timeFormat="yyyy-MM-dd" value="' + policy_expiration_date +
						'"   class="layui-input person_policy_expiration_date" maxlength="200" />' +
						'</th>' +
						'</tr>' +
						'</table>' +
						'</form>';
					layer.open({
						title: '修改人员',
						area: ['660px', '400px'],
						btn: ['确定', '取消'],
						content: html,
						yes: function(index, layero) {
							// $.post($(".layui-formEditPerson").attr('action'), $(".layui-formEditPerson").serialize(),
							// 	function(res) {
							// 		layer.msg(res.msg);
							// 		if (res.code == 1) {
							// 			reloadPersonTable(hiddenOrderId).then(function() {
							// 				form.render()
							// 				cover.hide()
							// 			})
							// 		}
							// 	}, "json");
							var result = {}
							$(".layui-formEditPerson").serialize().split('&').forEach(function(item, index) {
								var key_val = item.split('=')
								result[key_val[0]] = decodeURIComponent(key_val[1])
							})
							
							console.log('result',result);
							console.log('guarantee',guarantee);
							var $tr = $(that).closest('tr');
							for(var key in result){
								// console.log('key',key);
								var _key = key;
								if(key.indexOf('.') > -1){
									key = key.split('.');
									key = key[0] + key[1].substr(0,1).toUpperCase() + key[1].slice(1);
								}
								// console.log('key',key);
								var $td =	$tr.find("["+ key + "]");
								// console.log('$td',$td);
								if(key == 'groupInsurancePersonGender'){
									$td.val(result[_key] == '1' ? '男' : '女');
									//return
									continue;
								}
								if(key == 'groupInsurancePersonId_type'){
									$td.val(result[_key] == '0' ? '身份证' : '');
									//return;
									continue;
								}
								if(key == 'groupInsurancePersonStatus'){
									$td.val(result[_key] == '0' ? '加保' : '减保');
									//return;
									continue;
								}
								if(key == 'groupInsurancePersonGuarantee_id'){
									$.each(guarantee.guarantees, function(key, val) {
										guarantee=data;
										if (key == result[_key]) {
											$td.val(val);									} 
									});
									continue;
								}
								$td.val(result[_key])
								layer.close(index);
							}
							
						},
						no: function(index, layero) {
							layer.close(index);
						}
					});
					form.render();
		
					laydate.render({
						elem: '.person_policy_effective_date',
						format: 'yyyy-MM-dd HH:mm:ss',
						trigger: 'click'
					});
					laydate.render({
						elem: '.person_policy_expiration_date',
						format: 'yyyy-MM-dd HH:mm:ss',
						trigger: 'click'
					});
				}
			});
		}
	  form.render();
	  form.on('submit(submit)',function(data){
		  
		  branchTable.reload({
			  page:{
				  curr: 1
			  },
			  where: data.field
		  })
		  console.log(data.field)
	  })
	});
	</script>
#end
